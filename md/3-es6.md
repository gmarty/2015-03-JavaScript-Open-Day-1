## ECMAScript Harmony<br>(6th Edition)

* Nouvelle specification du JavaScript
* En cours d'implémentation
* Pas toujours retrocompatible

---

## Nouveautés ES6

---

### Arrow functions

---

### Arrow functions 1

<pre class="javascript"><span class="keyword">this</span>.returnAPromise().then(<span class="function"><span class="keyword"><del>function</del></span><span class="params">()</span><ins> =&gt;</ins> {</span>
  <span class="comment">// ... snippet...</span>
});</pre>

Note:
Super pouvoir #1: C'est plus court.

---

### Arrow functions 2

<pre class="javascript">ICEData.iceContacts.map(<span class="function"><span class="keyword"><del>function</del></span><span class="params"><del>(</del>contact<del>)</del></span> <ins>=&gt;</ins><del>{</del></span>
  <del><span class="keyword">return</span> </del>contact.active ? contact.id : <span class="literal">null</span><del>;</del>
<del>}</del>);</pre>

Note:
Super pouvoir #2: Pas besoin de `return`.

---

### Arrow functions 3

<pre class="javascript">setTimeout(<span class="function"><span class="keyword"><del>function</del></span><span class="params">()</span><ins> =&gt;</ins> {</span>
  <span class="keyword">if</span> (!<span class="keyword">this</span>.app) {
    <span class="keyword">return</span>;
  }
  <span class="keyword">this</span>.app.broadcast(<span class="string">'closingtimeout'</span>);
}<del>.bind(<span class="keyword">this</span>)</del>, TIMEOUT);</pre>

Note:
Super pouvoir #3: le scope est bindé automatiquement.

---

### String templates


---

### String templates 1

<pre class="javascript">AppStatusbar.prototype.view = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">var</span> content = <span class="string"><del>'' +</del><ins>`</ins>
    <del>'</del>&lt;div class="titlebar"&gt;<del>' +</del>
    <del>'</del>  &lt;div class="notifications-shadow"&gt;&lt;/div&gt;<del>' +</del>
    <del>'</del>  &lt;div class="statusbar-shadow titlebar-maximized"&gt;&lt;/div&gt;<del>' +</del>
    <del>'</del>  &lt;div class="statusbar-shadow titlebar-minimized"&gt;&lt;/div&gt;<del>' +</del>
    <del>'</del>&lt;/div&gt;<del>'</del><ins>`</ins></span>;
  <span class="keyword">return</span> content;
};</span></pre>

Note:
Super pouvoir #1: Multiligne.

---

### String templates 2

<pre class="javascript"><span class="keyword">var</span> learnMore = _(<span class="string">'fxa-learn-more'</span>);
<span class="comment">// ... snippet...</span>
<span class="keyword">var</span> template = document.createElement(<span class="string">'template'</span>);
template.innerHTML = <span class="string"><del>'</del><ins>`</ins>&lt;a id="coppa-link"&gt;<del>'</del></span><del> + </del><ins>${</ins>learnMore<ins>}</ins><del> + </del><span class="string"><del>'</del>&lt;/a&gt;<del>'</del><ins>`</ins></span>;</pre>

Note:
Super pouvoir #2: Insertion de variables.

---

### String templates 3

<pre class="javascript"><span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string"><del>'</del><ins>`</ins>Preferences_set: <del>\</del>'<del>'</del></span><del> + </del><ins>${</ins>value<ins>}</ins><del> + </del><span class="string"><del>'\</del>' must be an "integer".<del>'</del><ins>`</ins></span>);</pre>
<pre class="javascript"><span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string"><del>"</del><ins>`</ins>Preferences_set: '<del>"</del></span><del> + </del><ins>${</ins>value<ins>}</ins><del> + </del><span class="string"><del>"</del>' must be an <del>\</del>"integer<del>\</del>".<del>"</del><ins>`</ins></span>);</pre>

Note:
Super pouvoir #3: Pas besoin d'échapper les apostrophes ou guillemets.

---

### Spread operator

---

### Spread operator #1

<pre class="javascript">Process.prototype.next = <span class="function"><span class="keyword">function</span><span class="params">(<ins>...tasks</ins>)</span> {</span>
  <del><span class="keyword">var</span> tasks = [].slice.call(arguments);</del>
  tasks.forEach(task =&gt; {
    <span class="comment">// ... snippet...</span>
  });
);

process.next(task1, task2, task3);
process.next(taskA, taskB);</pre>

---

### Spread operator #2

<pre class="javascript"><span class="keyword">var</span> nodeList = document.querySelectorAll(<span class="string">'.notification .timestamp'</span>);
<span class="keyword">var</span> timestamps = <del>[].slice.call(</del><ins>[...</ins>nodeList<del>)</del><ins>]</ins>;

timestamps.forEach(element =&gt; {
  element.textContent = prettyDate(<span class="keyword">new</span> Date(element.dataset.timestamp));
});</pre>

---

### Destructuring

---

### Destructuring (Arrays)

<!--<pre class="javascript"><span class="keyword">var</span> <ins>[</ins>parent<del> = targetFile.parent.path</del>, filename<ins>]</ins> = <ins>[targetFile.parent.path, </ins>targetFile.leafName<ins>]</ins>;</pre>-->
<pre class="javascript"><span class="keyword">var</span> <ins>[</ins>parent<ins>, filename]</ins> = <ins>[</ins>targetFile.parent.path, <del>filename = </del>targetFile.leafName<ins>]</ins>;</pre>

---

### Destructuring (Objects)

<pre class="javascript">SecureWindowFactory.prototype.handleEvent = <span class="function"><span class="keyword">function</span><span class="params">(evt)</span> {</span>
  <span class="keyword">switch</span> (evt.type) {
    <span class="keyword">case</span> <span class="string">'secure-launchapp'</span>:
      <span class="keyword">var</span> detail = evt.detail;
      <span class="keyword">var</span> <ins>{</ins>appURL<del> = detail.appURL</del>, appManifestURL<ins>}</ins> = detail<del>.appManifestURL</del>;
      <span class="keyword">this</span>.create(appURL, appManifestURL);
      <span class="keyword">break</span>;
    <span class="comment">// ... snippet...</span>
  }
};</pre>

---

### Default parameters

<pre class="javascript">Timer.Panel.prototype.update = <span class="function"><span class="keyword">function</span><span class="params">(remaining<ins> = <span class="number">0</span></ins>)</span> {</span>
  <del><span class="keyword">if</span> (remaining === <span class="literal">undefined</span>) remaining = <span class="number">0</span>;</del>
  <span class="keyword">var</span> newText = format(Math.round(remaining / <span class="number">1000</span>), <span class="string">'hh:mm:ss'</span>);
  <span class="comment">// ... snippet...</span>
};</pre>

Note:
Super pouvoir: Permet de supprimer un statement.
Facilite la sanitisation des paramètres de fonctions.

---

### for... of loops

<pre class="javascript"><span class="keyword">for</span> (<span class="keyword">var</span> <del>i</del><ins>task</ins> <span class="keyword"><del>in</del><ins>of</ins></span> tasks) {
  <del><span class="keyword">var</span> task = tasks[i];</del>
  <span class="keyword">if</span> (<span class="keyword">this</span>.checkInterrupt(task)) {
    <span class="keyword">throw</span> <span class="keyword">new</span> Process.InterruptError();
  }
}</pre>

---

### const

<pre class="javascript"><span class="keyword"><del>var</del><ins>const</ins></span> DEBOUNCE_TIME = <span class="number">2000</span>;
<span class="keyword"><del>var</del><ins>const</ins></span> SCREENSHOT_TIMEOUT = <span class="number">5000</span>;</pre>

---

### Generators

<pre class="javascript"><span class="function"><span class="keyword">function</span><ins>*</ins> <span class="title">updateThreadNode</span><span class="params">(number)</span> {</span>
  <del><span class="comment">// Implement a finite-state machine!</span></del>
  <del><span class="comment">// ...</span></del>
  <del><span class="comment">// ...</span></del>
  <span class="keyword">var</span> contact = <ins><span class="keyword">yield</span> </ins>ThreadListUI.findContact(number, {photoURL: <span class="literal">true</span>});
  <span class="comment">// ... snippet...</span>
}</pre>

---

### Maps

<pre class="javascript"><span class="keyword">this</span>._icons = <del>Object.create</del><ins><span class="keyword">new</span> Map</ins>(<del><span class="literal">null</span></del>);
<span class="comment">// ... snippet...</span>
<del><span class="comment">// icon.name must be either a string or a number.</span></del>
<span class="keyword">this</span>._icons<del>[</del><ins>.set(</ins>icon.name<del>] =</del><ins>,</ins> icon<ins>)</ins>;</pre>

Note:
Meilleure sémantique.
+ d'autres avantages (tout type d'objet peut être une clé, length est dispo).
